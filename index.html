<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>çŸ­é“¾æ¥ç”Ÿæˆå™¨</title>
<style>
  body { font-family: system-ui, sans-serif; background:#0a0f1c; color:#eaf0ff; padding:2em; }
  input, select, button { margin:0.5em 0; padding:0.5em; width:100%; }
  button { cursor:pointer; background:#4d6aff; color:white; border:none; border-radius:5px; }
  .hidden { display:none; }
  .link-box { margin-top:1em; padding:0.5em; background:#1a2030; border-radius:5px; word-break:break-all; }
</style>
</head>
<body>
<h2>ğŸ”— çŸ­é“¾æ¥ç”Ÿæˆå™¨</h2>

<label>UID:
  <input type="text" id="uid" placeholder="è¾“å…¥æˆ–ç²˜è´´UID">
  <button type="button" onclick="pasteUid()">ğŸ“‹ ç²˜è´´</button>
</label>

<!-- æ–‡ä»¶åéšè— -->
<input type="text" id="file" value="pl.m3u" class="hidden">

<label>è¿‡æœŸæ—¶é—´:
  <select id="exp">
    <option value="2592000000">1ä¸ªæœˆ</option>       <!-- 30å¤©Ã—24hÃ—60mÃ—60sÃ—1000ms -->
    <option value="31536000000">1å¹´</option>        <!-- 365å¤© -->
    <option value="0">æ°¸ä¹…</option>
  </select>
</label>

<button onclick="generateLink()">ç”ŸæˆçŸ­é“¾æ¥</button>

<div class="link-box" id="linkBox"></div>

<script>
function pasteUid() {
  navigator.clipboard.readText().then(text => {
    document.getElementById("uid").value = text;
  }).catch(err => alert("ç²˜è´´å¤±è´¥"));
}

async function generateLink() {
  const uid = document.getElementById("uid").value.trim();
  const file = document.getElementById("file").value.trim();
  const expMs = Number(document.getElementById("exp").value);

  if(!uid) { alert("è¯·è¾“å…¥UID"); return; }

  // é©¬æ¥è¥¿äºšæ—¶é—´ UTC+8
  const malaysiaNow = Date.now() + 8*60*60*1000;
  const exp = expMs === 0 ? 0 : malaysiaNow + expMs;

  try {
    const resp = await fetch("/api/create-token", {
      method: "POST",
      headers: { "Content-Type":"application/json" },
      body: JSON.stringify({ uid, file, exp })
    });
    if(!resp.ok) throw new Error("è¯·æ±‚å¤±è´¥");
    const data = await resp.json();
    const shortCode = data.code;
    const link = `${window.location.origin}/id${shortCode}?uid=${uid}&exp=${exp}&sig=PLACEHOLDER`;
    document.getElementById("linkBox").innerHTML = `
      çŸ­é“¾æ¥: <a href="${link}" target="_blank">${link}</a>
      <button onclick="copyLink('${link}')">å¤åˆ¶é“¾æ¥</button>
    `;
  } catch(e) {
    alert("ç”Ÿæˆå¤±è´¥: " + e.message);
  }
}

function copyLink(link) {
  navigator.clipboard.writeText(link).then(()=> alert("å·²å¤åˆ¶åˆ°å‰ªè´´æ¿"));
}
</script>
</body>
</html>
