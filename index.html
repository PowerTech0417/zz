<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Token ç”Ÿæˆå™¨</title>
<style>
  body { font-family: system-ui, sans-serif; background: #0a0f1c; color: #eaf0ff; padding: 20px; }
  .card { background: #02040a; padding: 20px; border-radius: 12px; margin-bottom: 20px; }
  input, select, button { padding: 8px 12px; margin: 5px 0; border-radius: 6px; border: 1px solid #444; background: #0a0f1c; color: #eaf0ff; }
  button { cursor: pointer; background: #4d6aff; border: none; color: #fff; }
  button:hover { background: #3552d2; }
  .row { display: flex; gap: 10px; align-items: center; }
  .hidden { display: none; }
  #result { word-break: break-all; margin-top: 10px; }
</style>
</head>
<body>

<h1>ğŸ” Token ç”Ÿæˆå™¨</h1>

<div class="card">
  <div class="row">
    <label>UID:</label>
    <input type="text" id="uid" placeholder="è¯·è¾“å…¥ UID">
    <button onclick="pasteUid()">ğŸ“‹ ç²˜è´´</button>
  </div>

  <div class="row hidden">
    <label>æ–‡ä»¶å:</label>
    <input type="text" id="file" value="pl.m3u">
  </div>

  <div class="row">
    <label>è¿‡æœŸæ—¶é—´:</label>
    <select id="expSelect">
      <option value="month">1 ä¸ªæœˆ</option>
      <option value="year">1 å¹´</option>
      <option value="forever">æ°¸ä¹…</option>
    </select>
  </div>

  <div class="row">
    <button onclick="generateToken()">ç”ŸæˆçŸ­é“¾æ¥</button>
  </div>

  <div id="result"></div>
</div>

<script>
function pasteUid() {
  navigator.clipboard.readText().then(text => document.getElementById('uid').value = text);
}

function calculateExp(type) {
  const now = Date.now();
  const msMonth = 30*24*60*60*1000;
  const msYear = 365*24*60*60*1000;
  const msForever = 100*365*24*60*60*1000;
  let exp = now;
  if(type==='month') exp += msMonth;
  else if(type==='year') exp += msYear;
  else if(type==='forever') exp += msForever;
  return exp + 8*60*60*1000; // é©¬æ¥è¥¿äºšæ—¶é—´ +8h
}

async function generateToken() {
  const uid = document.getElementById('uid').value.trim();
  const file = document.getElementById('file').value.trim();
  const expType = document.getElementById('expSelect').value;
  if(!uid) return alert("è¯·è¾“å…¥ UID");

  const exp = calculateExp(expType);

  try {
    const res = await fetch("/api/create-token", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ uid, file, exp })
    });
    if(!res.ok) throw new Error("è¯·æ±‚å¤±è´¥");
    const data = await res.json();
    const code = data.code;
    const origin = window.location.origin.replace(/^https?:\/\//,''); // å»æ‰ https
    const link = `${origin}/${code}`;
    document.getElementById('result').innerHTML = `
      <div>çŸ­ç : <b>${code}</b></div>
      <div>é“¾æ¥: <b>${link}</b> <button onclick="copyLink('${link}')">ğŸ“‹ å¤åˆ¶é“¾æ¥</button></div>
    `;
  } catch(e) {
    alert("ç”Ÿæˆå¤±è´¥ï¼š" + e.message);
  }
}

function copyLink(link) {
  navigator.clipboard.writeText(link);
  alert("é“¾æ¥å·²å¤åˆ¶ï¼");
}
</script>

</body>
</html>
