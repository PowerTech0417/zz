<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>çŸ­é“¾æ¥ç”Ÿæˆå™¨</title>
<style>
  body {
    font-family: system-ui, sans-serif;
    background: #0a0f1c;
    color: #eaf0ff;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 2em;
  }
  input, select, button {
    padding: 0.6em;
    margin: 0.4em 0;
    border-radius: 0.4em;
    border: none;
    font-size: 1em;
  }
  input {
    width: 90%;
  }
  button {
    background: #4d6aff;
    color: white;
    cursor: pointer;
  }
  .short-link {
    margin-top: 1em;
    font-weight: bold;
    font-size: 1.2em;
  }
</style>
</head>
<body>

<h2>ç”ŸæˆçŸ­é“¾æ¥</h2>

<label>UIDï¼š</label>
<div>
  <input type="text" id="uid" placeholder="è¾“å…¥æˆ–ç²˜è´´ UID">
  <button type="button" onclick="pasteUid()">ğŸ“‹ ç²˜è´´</button>
</div>

<label>æ–‡ä»¶åï¼ˆéšè—ï¼‰</label>
<input type="text" id="file" placeholder="è‡ªåŠ¨éšè—" value="pl.m3u">

<label>è¿‡æœŸæ—¶é—´ï¼š</label>
<select id="expSelect">
  <option value="1m">1 ä¸ªæœˆ</option>
  <option value="1y">1 å¹´</option>
  <option value="perm">æ°¸ä¹…</option>
</select>

<button onclick="createToken()">ç”ŸæˆçŸ­é“¾æ¥</button>

<div class="short-link" id="result"></div>

<script>
// ç²˜è´´ UID
function pasteUid() {
  navigator.clipboard.readText().then(text => {
    document.getElementById("uid").value = text.trim();
  });
}

// ç”Ÿæˆè¿‡æœŸæ—¶é—´æˆ³ï¼ˆé©¬æ¥è¥¿äºšæ—¶é—´ï¼‰
function getExpTimestamp(option) {
  const now = Date.now() + 8*3600*1000; // +8 æ—¶åŒº
  if (option === "1m") return now + 30*24*3600*1000;
  if (option === "1y") return now + 365*24*3600*1000;
  return now + 100*365*24*3600*1000; // æ°¸ä¹… ~100å¹´
}

// ç”ŸæˆçŸ­é“¾æ¥
async function createToken() {
  const uid = document.getElementById("uid").value.trim();
  const file = document.getElementById("file").value.trim();
  const expOpt = document.getElementById("expSelect").value;
  if (!uid) {
    alert("è¯·å¡«å†™ UID");
    return;
  }

  const exp = getExpTimestamp(expOpt);

  try {
    const res = await fetch("/api/create-token", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ uid, file, exp })
    });
    if (!res.ok) throw new Error("è¯·æ±‚å¤±è´¥");
    const data = await res.json();
    const shortLink = `id${data.code}`; // éšè— https
    const resultEl = document.getElementById("result");
    resultEl.textContent = shortLink;

    // å¤åˆ¶æŒ‰é’®
    const copyBtn = document.createElement("button");
    copyBtn.textContent = "å¤åˆ¶é“¾æ¥";
    copyBtn.style.marginLeft = "0.5em";
    copyBtn.onclick = () => {
      navigator.clipboard.writeText(shortLink).then(()=> alert("å·²å¤åˆ¶!"));
    }
    resultEl.appendChild(copyBtn);

  } catch (e) {
    alert("ç”Ÿæˆå¤±è´¥ï¼š" + e.message);
    console.error(e);
  }
}
</script>

</body>
</html>
